(()=>{var e={};e.id=9204,e.ids=[9204],e.modules={2832:(e,s,t)=>{"use strict";t.r(s),t.d(s,{config:()=>h,default:()=>d,routeModule:()=>g});var r={};t.r(r),t.d(r,{default:()=>m});var n=t(3480),a=t(8667),c=t(6435),i=t(3939);let o=require("fs/promises");var l=t.n(o),u=t(3873),_=t.n(u);let p=(0,i.createClient)(process.env.SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE_KEY);async function m(e,s){try{let e={step1_fetch_schema:null,step2_generated_clients:[],step3_test_clients:[],errors:[]};try{console.log("Testing schema fetch...");let{data:s,error:t}=await p.rpc("get_all_tables");if(t)throw t;if(e.step1_fetch_schema={success:!0,tables_found:s?.length||0,tables:s||[]},s&&s.length>0){let{data:t,error:r}=await p.rpc("get_table_columns",{table_name_input:s[0]});e.step1_fetch_schema.sample_columns={table:s[0],columns:t||[],error:r?.message}}}catch(s){e.errors.push(`Schema fetch failed: ${s.message}`),e.step1_fetch_schema={success:!1,error:s.message}}try{console.log("Testing generated clients...");let s=_().resolve(process.cwd(),"lib/supabase/_generated/clients");try{for(let r of(await l().readdir(s)).filter(e=>e.endsWith(".ts")).slice(0,3))try{let s=r.replace(".ts",""),n=await t(4256)(`./${s}`);n[`${s}Client`]?.()?e.step2_generated_clients.push({table:s,status:"success",has_client:!0}):e.step2_generated_clients.push({table:s,status:"warning",has_client:!1,message:"Client function not found"})}catch(s){e.step2_generated_clients.push({table:r,status:"error",error:s.message})}}catch(s){e.errors.push(`Clients directory not found: ${s.message}`)}}catch(s){e.errors.push(`Generated clients test failed: ${s.message}`)}try{for(let s of(console.log("Testing database operations..."),["users","announcements"]))try{let{data:t,error:r}=await p.from(s).select("*").limit(1);e.step3_test_clients.push({table:s,status:r?"error":"success",data_count:t?.length||0,error:r?.message})}catch(t){e.step3_test_clients.push({table:s,status:"error",error:t.message})}}catch(s){e.errors.push(`Database operations test failed: ${s.message}`)}return s.status(200).json({message:"Schema pipeline test completed",timestamp:new Date().toISOString(),results:e,summary:{schema_fetch_working:e.step1_fetch_schema?.success||!1,generated_clients_count:e.step2_generated_clients.length,database_operations_working:e.step3_test_clients.filter(e=>"success"===e.status).length,total_errors:e.errors.length}})}catch(t){console.error("Pipeline test error:",t);let e=t instanceof Error?t.message:"Unknown error occurred";return s.status(500).json({error:e})}}let d=(0,c.M)(r,"default"),h=(0,c.M)(r,"config"),g=new n.PagesAPIRouteModule({definition:{kind:a.A.PAGES_API,page:"/api/test-schema-pipeline",pathname:"/api/test-schema-pipeline",bundlePath:"",filename:""},userland:r})},3480:(e,s,t)=>{"use strict";e.exports=t(5600)},3873:e=>{"use strict";e.exports=require("path")},3939:e=>{"use strict";e.exports=require("@supabase/supabase-js")},4256:(e,s,t)=>{var r={"./":[9812,9812],"./announcements":[8532,8532],"./announcements.ts":[8532,8532],"./attendance":[949,949],"./attendance.ts":[949,949],"./attendance_records":[5086,5086],"./attendance_records.ts":[5086,5086],"./children":[3761,3761],"./children.ts":[3761,3761],"./class_assignments":[4799,4799],"./class_assignments.ts":[4799,4799],"./classes":[9008,9008],"./classes.ts":[9008,9008],"./config_fields":[5306,5306],"./config_fields.ts":[5306,5306],"./curriculum":[5641,5641],"./curriculum.ts":[5641,5641],"./curriculum_assignments":[2618,2618],"./curriculum_assignments.ts":[2618,2618],"./curriculum_executions":[4297,4297],"./curriculum_executions.ts":[4297,4297],"./curriculum_imports":[7530,7530],"./curriculum_imports.ts":[7530,7530],"./curriculum_items":[1456,1456],"./curriculum_items.ts":[1456,1456],"./curriculum_templates":[7709,7709],"./curriculum_templates.ts":[7709,7709],"./daily_logs":[7315,7315],"./daily_logs.ts":[7315,7315],"./events":[9023,9023],"./events.ts":[9023,9023],"./index":[9812,9812],"./index.ts":[9812,9812],"./message_threads":[7527,7527],"./message_threads.ts":[7527,7527],"./messages":[732,732],"./messages.ts":[732,732],"./milestones":[2993,2993],"./milestones.ts":[2993,2993],"./notifications":[7540,7540],"./notifications.ts":[7540,7540],"./parent_child_relationships":[7431,7431],"./parent_child_relationships.ts":[7431,7431],"./photo_albums":[1127,1127],"./photo_albums.ts":[1127,1127],"./photo_tags":[1064,1064],"./photo_tags.ts":[1064,1064],"./photos":[4587,4587],"./photos.ts":[4587,4587],"./reports":[9101,9101],"./reports.ts":[9101,9101],"./student_progress":[7257,7257],"./student_progress.ts":[7257,7257],"./system_logs":[1047,1047],"./system_logs.ts":[1047,1047],"./time_slots":[2901,2901],"./time_slots.ts":[2901,2901],"./users":[5040,5040],"./users.ts":[5040,5040],"./worksheets":[8235,8235],"./worksheets.ts":[8235,8235]};function n(e){if(!t.o(r,e))return Promise.resolve().then(()=>{var s=Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s});var s=r[e],n=s[0];return t.e(s[1]).then(()=>t(n))}n.keys=()=>Object.keys(r),n.id=4256,e.exports=n},5600:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6435:(e,s)=>{"use strict";Object.defineProperty(s,"M",{enumerable:!0,get:function(){return function e(s,t){return t in s?s[t]:"then"in s&&"function"==typeof s.then?s.then(s=>e(s,t)):"function"==typeof s&&"default"===t?s:void 0}}})},8667:(e,s)=>{"use strict";Object.defineProperty(s,"A",{enumerable:!0,get:function(){return t}});var t=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})}};var s=require("../../webpack-api-runtime.js");s.C(e);var t=s(s.s=2832);module.exports=t})();