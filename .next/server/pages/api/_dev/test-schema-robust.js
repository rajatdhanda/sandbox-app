"use strict";(()=>{var e={};e.id=5060,e.ids=[5060],e.modules={3480:(e,t,s)=>{e.exports=s(5600)},3939:e=>{e.exports=require("@supabase/supabase-js")},5052:(e,t,s)=>{s.r(t),s.d(t,{config:()=>u,default:()=>l,routeModule:()=>p});var r={};s.r(r),s.d(r,{default:()=>i});var n=s(3480),a=s(8667),o=s(6435);let c=(0,s(3939).createClient)(process.env.SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE_KEY);async function i(e,t){try{let e={pipeline_status:"success",steps:{schema_fetch:null,client_generation:null,end_to_end_test:null},recommendations:[]};console.log("\uD83D\uDD0D Testing schema fetch capabilities...");try{let{data:t,error:s}=await c.rpc("get_all_tables");if(s)throw s;if(e.steps.schema_fetch={status:"success",tables_count:t?.length||0,sample_tables:t?.slice(0,5)||[],message:`Found ${t?.length||0} tables in database`},t&&t.length>0){let s=t[0],{data:r,error:n}=await c.rpc("get_table_columns",{table_name_input:s});e.steps.schema_fetch.sample_schema={table:s,columns_count:r?.length||0,columns:r?.slice(0,3)||[]}}}catch(t){e.steps.schema_fetch={status:"error",error:t.message,message:"Schema fetch failed - check RPC functions"},e.recommendations.push("Run the SQL functions in Supabase SQL Editor")}console.log("\uD83D\uDD27 Testing direct client operations...");try{let t=[];for(let e of["users","announcements","classes"])try{let s=await c.from(e).select("*").limit(2),r=await c.from(e).select("*",{count:"exact",head:!0});t.push({table:e,select_status:s.error?"error":"success",count_status:r.error?"error":"success",record_count:r.count||0,sample_data:s.data?.length||0,errors:[s.error?.message,r.error?.message].filter(Boolean)})}catch(s){t.push({table:e,status:"error",error:s.message})}e.steps.client_generation={status:"success",message:"Direct Supabase clients working",operations_tested:t,working_tables:t.filter(e=>"success"===e.select_status).length}}catch(t){e.steps.client_generation={status:"error",error:t.message}}console.log("\uD83D\uDE80 Testing end-to-end workflow...");try{let t={schema_available:(e.steps.schema_fetch?.status,!1),clients_working:(e.steps.client_generation?.status,!1),generated_files_path:"lib/supabase/_generated/clients/",ready_for_production:!1};t.ready_for_production=t.schema_available&&t.clients_working,e.steps.end_to_end_test={status:t.ready_for_production?"success":"needs_attention",workflow:t,message:t.ready_for_production?"Pipeline is ready for production use":"Pipeline needs some fixes before production"},t.schema_available||e.recommendations.push("Fix schema fetching - ensure RPC functions are created"),t.clients_working||e.recommendations.push("Fix client generation - check import paths and file structure"),t.ready_for_production&&e.recommendations.push("âœ… Ready to run: npx tsx schema/index.ts && npx tsx schema/copy-to-edits.mts && npx tsx schema/generate-clients-from-edits.mts")}catch(t){e.steps.end_to_end_test={status:"error",error:t.message}}let s=Object.values(e.steps).every(e=>e?.status==="success");return e.pipeline_status=s?"ready":"needs_fixes",t.status(200).json({message:"Schema pipeline comprehensive test completed",timestamp:new Date().toISOString(),overall_status:e.pipeline_status,results:e,next_steps:e.recommendations})}catch(s){console.error("Robust pipeline test error:",s);let e=s instanceof Error?s.message:"Unknown error occurred";return t.status(500).json({error:e,message:"Pipeline test failed completely"})}}let l=(0,o.M)(r,"default"),u=(0,o.M)(r,"config"),p=new n.PagesAPIRouteModule({definition:{kind:a.A.PAGES_API,page:"/api/_dev/test-schema-robust",pathname:"/api/_dev/test-schema-robust",bundlePath:"",filename:""},userland:r})},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,s){return s in t?t[s]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,s)):"function"==typeof t&&"default"===s?t:void 0}}})},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return s}});var s=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var s=t(t.s=5052);module.exports=s})();